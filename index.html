<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Citas del Ritmo Interior</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: transparent;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }
        .widget-card {
            background: linear-gradient(145deg, #1a202c, #2d3748);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        .moon-bg {
            position: absolute;
            top: -20px;
            right: -20px;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(226, 232, 240, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
        }
        .quote-text {
            color: #e2e8f0;
            font-size: 1.15rem;
            line-height: 1.6;
            margin-bottom: 1rem;
            font-weight: 300;
            font-style: italic;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .quote-author {
            color: #9f7aea;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 500;
            margin-bottom: 1.5rem;
        }
        .action-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .btn-base {
            padding: 8px 16px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 0.7rem;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 1px solid transparent;
        }
        .btn-refresh {
            background: rgba(159, 122, 234, 0.1);
            color: #d6bcfa;
            border-color: rgba(159, 122, 234, 0.3);
        }
        .btn-refresh:hover {
            background: rgba(159, 122, 234, 0.3);
        }
        .btn-gemini {
            background: linear-gradient(90deg, #6366f1, #a855f7);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
        .btn-gemini:hover {
            opacity: 0.9;
            transform: scale(1.05);
        }
        .copy-hint {
            font-size: 0.6rem;
            color: #718096;
            margin-top: 12px;
            cursor: pointer;
        }
        .loading-dots:after {
            content: '.';
            animation: dots 1.5s steps(5, end) infinite;
        }
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60% { content: '...'; }
            80%, 100% { content: ''; }
        }
    </style>
</head>
<body>

<div class="widget-card">
    <div class="moon-bg"></div>
    <div id="quote-container">
        <p class="quote-text" id="text">"Tu ritmo interior guía el camino..."</p>
        <p class="quote-author" id="author">Sabiduría Silenciosa</p>
    </div>
    
    <div class="action-group">
        <button class="btn-base btn-refresh" onclick="newQuote()">Estática</button>
        <button class="btn-base btn-gemini" id="geminiBtn" onclick="generateAIQuote()">
            ✨ Canalizar IA
        </button>
    </div>
    
    <p class="copy-hint" onclick="copyQuote()">Toca para copiar</p>
</div>

<script>
    // IMPORTANTE: Si vas a usar GitHub Pages, pega tu API Key aquí abajo si quieres que funcione fuera de este entorno
    const apiKey = ""; 
    
    const quotes = [
        { text: "La muerte no es el final, sino un cambio de estado de conciencia.", author: "Dr. Manuel Sans Segarra" },
        { text: "El amor es la fuerza más poderosa del universo; sin él, nada tiene sentido.", author: "Ami, el niño de las estrellas" },
        { text: "Nuestra verdadera esencia es luz y energía eterna.", author: "Noelia Pace" },
        { text: "La naturaleza es el templo donde el alma descansa.", author: "Ritmo Interior" },
        { text: "Cada célula de tu cuerpo responde a tus pensamientos.", author: "Medicina China" },
        { text: "En el silencio del bosque se escuchan las respuestas que el ruido oculta.", author: "Fannuchy" }
    ];

    async function fetchGemini(prompt) {
        let retries = 0;
        const delays = [1000, 2000, 4000, 8000, 16000];
        
        while (retries < 5) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { 
                            parts: [{ text: "Eres un oráculo espiritual moderno. Generas citas cortas (máximo 20 palabras) sobre espiritualidad, ciencia cuántica, naturaleza y el 'ritmo interior'. Responde en español." }] 
                        },
                        generationConfig: {
                            responseMimeType: "application/json",
                            responseSchema: {
                                type: "OBJECT",
                                properties: {
                                    text: { type: "STRING" },
                                    author: { type: "STRING" }
                                }
                            }
                        }
                    })
                });

                if (!response.ok) throw new Error('API Error');
                const data = await response.json();
                return JSON.parse(data.candidates[0].content.parts[0].text);
            } catch (e) {
                await new Promise(res => setTimeout(res, delays[retries]));
                retries++;
            }
        }
        throw new Error('No se pudo conectar con el oráculo.');
    }

    async function generateAIQuote() {
        const textEl = document.getElementById('text');
        const authorEl = document.getElementById('author');
        const btn = document.getElementById('geminiBtn');
        
        textEl.innerHTML = '<span class="loading-dots">Canalizando energía</span>';
        authorEl.innerText = "...";
        btn.disabled = true;

        try {
            const result = await fetchGemini("Genera una reflexión profunda sobre la conexión entre la naturaleza, la conciencia eterna y el alivio del alma.");
            textEl.style.opacity = 0;
            setTimeout(() => {
                textEl.innerText = `"${result.text}"`;
                authorEl.innerText = `✨ ${result.author}`;
                textEl.style.opacity = 1;
            }, 300);
        } catch (error) {
            textEl.innerText = "La conexión con el éter es débil ahora. Intenta de nuevo.";
            authorEl.innerText = "Error de Red";
        } finally {
            btn.disabled = false;
        }
    }

    function newQuote() {
        const randomIndex = Math.floor(Math.random() * quotes.length);
        const quote = quotes[randomIndex];
        const textEl = document.getElementById('text');
        const authorEl = document.getElementById('author');
        
        textEl.style.opacity = 0;
        setTimeout(() => {
            textEl.innerText = `"${quote.text}"`;
            authorEl.innerText = quote.author;
            textEl.style.opacity = 1;
        }, 300);
    }

    function copyQuote() {
        const text = document.getElementById('text').innerText;
        const author = document.getElementById('author').innerText;
        const fullText = `${text} - ${author}`;
        
        const el = document.createElement('textarea');
        el.value = fullText;
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);
        
        const hint = document.querySelector('.copy-hint');
        hint.innerText = "¡Copiado!";
        setTimeout(() => hint.innerText = "Toca para copiar", 2000);
    }

    window.onload = newQuote;
</script>

</body>
</html>
